# PRD: ConfigForge

## 1. 产品概述

### 1.1 文档标题和版本

- PRD: ConfigForge - 基础 SSH 配置管理器 (macOS) - 第一版 MVP
- 版本: 1.0

### 1.2 产品摘要

ConfigForge 旨在为 macOS 用户提供一个简洁直观的图形界面工具，用于管理其 `~/.ssh/config` 文件。许多开发者和系统管理员需要维护多个 SSH 连接配置，直接编辑配置文件可能效率低下且容易出错。

此项目的第一版（MVP）将专注于核心的 SSH 配置条目管理功能。用户将能够查看、搜索、排序、编辑、添加和删除 `~/.ssh/config` 文件中的条目。此外，还将提供一个简单的文本编辑器，具备基础的语法高亮和验证功能，以及手动备份和恢复配置文件的能力。

该应用程序将使用 SwiftUI 构建，确保提供现代化的 macOS 原生体验，并优先考虑简洁性和易用性，帮助用户更高效、更安全地管理他们的 SSH 配置。

## 2. 目标

### 2.1 业务目标

- 为 macOS 用户提供一个基础但实用的 SSH 配置管理工具，填补市场空白。
- 通过 MVP 版本快速验证核心功能的可行性和用户接受度。
- 为后续版本迭代收集用户反馈，奠定基础。

### 2.2 用户目标

- 能够在一个图形界面中方便地查看所有 SSH 配置条目。
- 能够快速搜索和定位特定的 SSH 配置。
- 能够轻松地编辑、添加和删除 SSH 配置条目，无需直接操作文本文件。
- 能够对 `~/.ssh/config` 文件进行简单的备份和恢复，防止意外修改导致的问题。
- 获得比直接编辑文本文件更友好的编辑体验（如基础语法高亮）。

### 2.3 非目标

- （MVP 版本）提供高级 SSH 功能管理，例如 SSH 密钥生成、管理或自动同步。
- （MVP 版本）支持除 `~/.ssh/config` 之外的其他 SSH 配置文件或格式。
- （MVP 版本）实现复杂的语法验证或自动完成功能。
- （MVP 版本）提供云同步或团队协作功能。
- （MVP 版本）支持 macOS 以外的其他操作系统。
- （MVP 版本）实现复杂的异步文件处理或冲突解决机制。

## 3. 用户画像

### 3.1 主要用户类型

- 需要管理多个 SSH 服务器连接的 macOS 用户。
- 软件开发者。
- 系统管理员/运维工程师。
- 网络工程师。
- 经常使用终端进行远程操作的技术人员。

### 3.2 基本用户画像详情

- **开发者 Alex**: Alex 是一名 macOS 用户，日常需要连接到多个开发、测试和生产环境的服务器。他希望有一个简单的工具能帮他快速查找和修改 SSH 配置，而不是每次都在终端用 `vim` 编辑 `~/.ssh/config`。
- **系统管理员 Sarah**: Sarah 管理着数十台服务器，她的 `~/.ssh/config` 文件包含了各种复杂的配置。她需要一个能清晰展示所有条目，并能方便删除不再使用的旧条目的工具，同时希望有简单的备份机制以防万一。

### 3.3 基于角色的访问权限

此应用程序为单用户桌面应用程序，没有复杂的角色区分。所有功能对安装和运行该应用程序的用户均可用。

- **配置管理员**: 可以查看、搜索、排序、添加、编辑和删除 `~/.ssh/config` 文件中的条目，并执行手动备份和恢复操作。

## 4. 功能需求

- **查看 SSH 配置列表** (优先级: 高)
  - 应用启动时自动加载并显示 `~/.ssh/config` 文件中的所有条目。
  - 列表应清晰展示每个条目的 `Host` 名称。
- **搜索 SSH 配置** (优先级: 高)
  - 提供搜索框，允许用户根据 `Host` 名称进行实时过滤。
  - 搜索应不区分大小写。
- **排序 SSH 配置** (优先级: 中)
  - 默认按 `Host` 名称的字母顺序升序排列列表。
  - （未来可考虑）支持按其他字段或不同顺序排序。
- **删除 SSH 配置条目** (优先级: 高)
  - 允许用户通过右键菜单或按钮选择并删除一个或多个配置条目。
  - 删除前应有确认提示。
- **编辑 SSH 配置条目** (优先级: 高)
  - 允许用户选择一个条目并在编辑器区域查看和修改其内容。
  - 编辑器应支持基本的文本编辑功能（复制、粘贴、撤销、重做）。
  - 保存编辑后，应更新 `~/.ssh/config` 文件。
- **添加新的 SSH 配置条目** (优先级: 高)
  - 提供添加新条目的功能，允许用户在编辑器中输入新的配置信息。
  - 保存新条目后，应将其追加到 `~/.ssh/config` 文件。
- **基础语法高亮** (优先级: 中)
  - 在编辑器中对常见的 SSH 配置关键字（如 `Host`, `HostName`, `User`, `Port`, `IdentityFile` 等）进行简单的颜色高亮。
- **基础语法验证** (优先级: 低)
  - 在保存编辑或添加新条目时，进行基础验证。
  - （MVP 简化）仅检查 `Host` 名称是否在文件中唯一。如果存在重复，应提示用户。
- **手动备份配置** (优先级: 中)
  - 提供一个按钮，允许用户将当前的 `~/.ssh/config` 文件备份到用户选择的位置（或默认位置，如桌面），并带有时间戳。
- **手动恢复配置** (优先级: 中)
  - 提供一个按钮，允许用户选择一个之前备份的配置文件。
  - （MVP 简化）恢复操作将用选定的备份文件直接覆盖当前的 `~/.ssh/config` 文件。恢复前应有明确的警告和确认提示。

## 5. 用户体验

### 5.1. 入口点和首次用户流程

- 用户通过 macOS 的应用程序文件夹或 Dock 启动 ConfigForge。
- 首次启动时，应用会尝试读取 `~/.ssh/config` 文件。如果文件不存在或无法访问（权限问题），应向用户显示友好的提示信息，并指导如何创建文件或授予权限。
- 成功读取后，主界面将显示 SSH 配置列表。

### 5.2. 核心体验

- **查看列表**: 用户启动应用，立即看到按 `Host` 字母顺序排列的 SSH 配置列表。
  - 列表加载迅速，界面简洁明了。
- **搜索定位**: 用户在顶部的搜索框输入 `Host` 关键字，列表实时过滤，快速找到目标配置。
  - 搜索响应灵敏，结果准确。
- **选择与编辑**: 用户单击列表中的某个条目，该条目的详细配置会显示在右侧编辑器区域。
  - 编辑器清晰展示配置内容，基础语法高亮提升可读性。
- **修改与保存**: 用户在编辑器中修改配置，点击“保存”按钮。应用执行基础验证（如 Host 唯一性），验证通过后更新 `~/.ssh/config` 文件。
  - 保存操作快速完成，并有成功提示或错误信息反馈。
- **添加条目**: 用户点击“添加”按钮，编辑器变为空白或包含基本模板，用户输入新配置后点击“保存”。
  - 添加流程直观，易于理解。
- **删除条目**: 用户右键点击列表中的条目，选择“删除”，在确认对话框中点击“确认”后，条目从列表和 `~/.ssh/config` 文件中移除。
  - 删除操作有清晰的确认步骤，防止误操作。
- **备份/恢复**: 用户在需要时，点击“备份”按钮保存当前配置，或点击“恢复”按钮选择备份文件覆盖当前配置。
  - 备份恢复操作有明确的按钮和流程引导，并包含必要的警告信息。

### 5.3. 高级功能和边缘情况

- **空配置文件**: 如果 `~/.ssh/config` 文件为空，列表区域应显示提示信息，引导用户添加新条目。
- **文件权限问题**: 如果应用没有读取或写入 `~/.ssh/config` 的权限，应检测并提示用户如何解决（例如，通过系统偏好设置授予“完全磁盘访问权限”或调整文件权限）。
- **配置文件格式错误**: （MVP 简化）对于无法基础解析的行或格式，可以尝试原样显示在编辑器中，或者在列表视图中标记为“无法解析”，保存时也原样写回。基础验证仅关注 `Host` 唯一性。
- **大型配置文件**: （MVP 假设）假设配置文件不会非常巨大。如果未来遇到性能问题，需要优化文件读写和解析逻辑。
- **并发修改**: （MVP 忽略）假设用户不会同时通过 ConfigForge 和其他编辑器修改 `~/.ssh/config`。应用在每次操作（加载、保存）时都直接读写文件。

### 5.4. UI/UX 亮点

- **极简设计**: 遵循 macOS 的设计语言，界面干净、整洁，无不必要的装饰元素。
- **原生体验**: 使用 SwiftUI 构建，提供流畅的动画、标准的控件和良好的性能。
- **直观操作**: 功能布局清晰，用户无需学习即可快速上手核心的增删改查操作。
- **键盘友好**: 支持使用键盘在列表中上下导航选择条目，以及在编辑器中进行文本操作。

## 6. 叙述

Alex 是一名依赖 macOS 进行日常开发的软件工程师，他需要频繁连接到不同的远程服务器进行代码部署和调试。每次查找特定服务器的 `HostName` 或 `User` 都需要打开终端，用 `vim` 费力地在日益增长的 `~/.ssh/config` 文件中滚动和搜索，修改配置时还担心不小心破坏了文件结构。他发现了 ConfigForge 这个小工具，它提供了一个简洁的图形界面，能清晰地列出所有 SSH 配置，通过简单的搜索就能快速定位，编辑和保存也变得非常直观，甚至还有基础的语法高亮防止他写错关键字。现在，Alex 可以更自信、更高效地管理他的 SSH 连接了，而且手动备份功能让他更加安心。

## 7. 成功指标

### 7.1. 以用户为中心的指标

- **任务完成率**: 用户成功完成添加、编辑、删除、搜索 SSH 配置条目的比例。
- **采用率**: 下载和首次启动应用的用户数量。
- **用户反馈**: 通过 App Store 评论或反馈渠道收集的用户满意度和改进建议。
- **会话时长/频率**: 用户使用应用的平均时长和频率（表明应用是否被经常使用）。

### 7.2. 业务指标

- （如果发布到 App Store）下载量和评分。
- 错误报告数量和严重程度。

### 7.3. 技术指标

- **应用启动时间**: 从点击图标到主界面可用的时间。
- **文件加载/保存时间**: 处理 `~/.ssh/config` 文件的速度，尤其是在文件变大时。
- **CPU 和内存使用率**: 确保应用资源消耗合理。
- **崩溃率**: 应用的稳定性和崩溃频率。

## 8. 技术考量

### 8.1. 集成点

- （MVP）无外部系统集成。仅与本地文件系统交互 (`~/.ssh/config`)。

### 8.2. 数据存储和隐私

- **数据存储**: 应用直接读写用户主目录下的 `~/.ssh/config` 文件。备份文件默认存储在用户指定位置（如桌面）。
- **隐私**: `~/.ssh/config` 文件可能包含敏感信息（主机名、用户名、密钥文件路径等）。应用本身不存储、不传输这些信息，仅在本地进行处理。需要确保文件读写操作的安全性，遵循 macOS 的沙盒和权限模型。备份文件的存储位置由用户控制。

### 8.3. 可扩展性和性能

- **可扩展性**: MVP 版本设计为处理中小型配置文件。如果需要支持超大型文件（成千上万行），需要重新评估解析和列表渲染策略（例如，虚拟列表、异步加载）。功能扩展性方面，当前架构为未来添加更复杂功能（如密钥管理）留有空间。
- **性能**: 文件 I/O 操作（读/写）应尽可能高效。列表滚动和搜索过滤需要保持流畅。SwiftUI 的性能特性应被充分利用。MVP 阶段同步文件操作是可接受的，但未来可能需要改为异步。

### 8.4. 潜在挑战

- **`~/.ssh/config` 文件格式的复杂性**: SSH 配置语法虽然有规范，但实际文件中可能存在各种注释、空行、缩进和非标准写法。编写一个健壮且能兼容各种情况的基础解析器是一个挑战。
- **文件权限**: 正确处理 macOS 的文件系统权限，尤其是在沙盒环境下访问 `~/.ssh` 目录可能需要用户授权。
- **错误处理**: 需要为文件读写失败、解析错误、权限不足等情况提供清晰的用户反馈和可能的解决方案。
- **状态管理**: 确保 SwiftUI 视图状态与底层文件内容的一致性，尤其是在编辑和保存操作中。

## 10. 用户故事

### 10.1. 查看 SSH 配置列表

- **ID**: US-001
- **描述**: 作为一个 macOS 用户，我希望能在一个列表中看到我 `~/.ssh/config` 文件里的所有配置条目，以便我能快速概览我的 SSH 连接。
- **验收标准**:
  - 应用启动时，自动读取 `~/.ssh/config` 文件。
  - 文件中的每个 SSH `Host` 条目（以 `Host` 或 `Match` 关键字开头的块）都在主界面列表中显示为单独一项。
  - 列表项至少显示每个条目的 `Host` 名称。
  - 如果文件不存在或无法读取，显示友好的错误或提示信息。
  - 列表默认按 `Host` 名称的字母顺序升序排列。

### 10.2. 搜索特定 SSH 配置

- **ID**: US-002
- **描述**: 作为一个 macOS 用户，当我的配置列表很长时，我希望能通过输入 `Host` 名称来快速过滤列表，以便我能迅速找到我想管理的那个配置。
- **验收标准**:
  - 主界面提供一个搜索输入框。
  - 当我在搜索框中输入文本时，列表会实时过滤，只显示 `Host` 名称包含输入文本（不区分大小写）的条目。
  - 清空搜索框后，列表恢复显示所有条目。
  - 搜索性能流畅，即使在有数百个条目的列表中也不会卡顿。

### 10.3. 编辑现有的 SSH 配置条目

- **ID**: US-003
- **描述**: 作为一个 macOS 用户，我希望能选择一个 SSH 配置条目并修改它的详细内容（例如 `HostName`, `User`, `Port` 等），以便我能更新我的连接设置。
- **验收标准**:
  - 点击列表中的一个条目后，其完整的配置内容会显示在一个文本编辑区域。
  - 我可以在文本编辑区域中修改内容。
  - 编辑器提供基础的文本编辑功能（如复制、粘贴、撤销、重做）。
  - 有一个“保存”按钮。点击保存时，应用会尝试将修改后的内容写回 `~/.ssh/config` 文件，覆盖原始条目。
  - 保存前会进行基础的 `Host` 唯一性验证。如果 `Host` 名称与其他现有条目冲突（且不是当前编辑的条目本身），则提示错误，不允许保存。
  - 保存成功后，列表视图（如果 `Host` 名称被修改）和编辑器内容会更新。
  - 如果保存失败（例如，文件写入权限问题），会向用户显示错误信息。

### 10.4. 添加新的 SSH 配置条目

- **ID**: US-004
- **描述**: 作为一个 macOS 用户，我希望能添加一个新的 SSH 配置条目到我的 `~/.ssh/config` 文件中，以便我能设置新的服务器连接。
- **验收标准**:
  - 界面上有一个“添加”或“新建”按钮。
  - 点击该按钮后，编辑器区域变为空白或显示一个基础的配置模板（例如 `Host new-host\n  HostName \n  User \n`）。
  - 我可以在编辑器中输入新配置的 `Host` 名称和相关参数。
  - 有一个“保存”按钮。点击保存时，应用会进行 `Host` 唯一性验证。
  - 如果验证通过，新的配置条目会被追加到 `~/.ssh/config` 文件的末尾（或按 `Host` 排序插入，取决于实现）。
  - 保存成功后，新条目会出现在主列表视图中。
  - 如果 `Host` 名称已存在，提示错误，不允许保存。
  - 如果保存失败（例如，文件写入权限问题），显示错误信息。

### 10.5. 删除 SSH 配置条目

- **ID**: US-005
- **描述**: 作为一个 macOS 用户，我希望能从我的 `~/.ssh/config` 文件中删除不再需要的配置条目，以便保持我的配置文件整洁。
- **验收标准**:
  - 我可以选中列表中的一个或多个条目。
  - 通过右键菜单或界面上的“删除”按钮可以触发删除操作。
  - 删除前，系统会弹出一个确认对话框，询问我是否确定要删除。
  - 确认后，选中的条目会从 `~/.ssh/config` 文件中移除。
  - 列表视图会同步更新，移除被删除的条目。
  - 如果删除失败（例如，文件写入权限问题），显示错误信息。

### 10.6. 查看基础语法高亮

- **ID**: US-006
- **描述**: 作为一个 macOS 用户，在编辑 SSH 配置时，我希望能看到常见的关键字（如 `Host`, `HostName`, `User`）有不同的颜色显示，以便我能更容易地阅读和识别配置项。
- **验收标准**:
  - 在编辑区域显示的 SSH 配置文本中，预定义的关键字（例如 `Host`, `HostName`, `User`, `Port`, `IdentityFile`, `ProxyCommand` 等）以不同于普通文本的颜色高亮显示。
  - 注释行（以 `#` 开头）也可能以特定颜色显示。
  - 高亮不影响文本编辑功能。

### 10.7. 手动备份配置文件

- **ID**: US-007
- **描述**: 作为一个 macOS 用户，我希望能手动创建一个 `~/.ssh/config` 文件的备份副本，以防我在编辑时不小心弄坏了配置。
- **验收标准**:
  - 界面上有一个“备份”按钮。
  - 点击按钮后，应用会将当前的 `~/.ssh/config` 文件内容复制到一个新的文件中。
  - 备份文件应保存在用户选择的位置（或一个明确的默认位置，如桌面），并包含日期和时间戳以作区分（例如 `config_backup_YYYYMMDD_HHMMSS`）。
  - 备份成功后，给予用户提示。
  - 如果备份过程中发生错误（例如，无法写入目标位置），显示错误信息。

### 10.8. 手动恢复配置文件

- **ID**: US-008
- **描述**: 作为一个 macOS 用户，如果我当前的 `~/.ssh/config` 文件出现了问题，我希望能从之前创建的备份文件中恢复配置。
- **验收标准**:
  - 界面上有一个“恢复”按钮。
  - 点击按钮后，应用会提示我选择一个备份文件。
  - 在我选择了一个有效的备份文件后，应用会显示一个明确的警告信息，说明当前 `~/.ssh/config` 将被覆盖。
  - 我确认恢复操作后，应用会用所选备份文件的内容替换当前的 `~/.ssh/config` 文件。
  - 恢复成功后，主列表视图会刷新以显示恢复后的配置内容。
  - 如果恢复过程中发生错误（例如，文件读取或写入失败），显示错误信息。

### 10.9. 使用键盘导航

- **ID**: US-009
- **描述**: 作为一个偏好使用键盘的 macOS 用户，我希望能使用键盘快捷键在 SSH 配置列表中上下移动选择条目，并在编辑器中进行基本的文本操作。
- **验收标准**:
  - 当焦点在列表视图时，可以使用上/下箭头键来改变选中的条目。
  - 当焦点在编辑器区域时，标准的文本编辑快捷键（如 `Cmd+C`, `Cmd+V`, `Cmd+Z`, `Cmd+Shift+Z`, 方向键移动光标等）可以正常工作。
  - （可选）可以使用 `Tab` 键在列表、搜索框和编辑器等主要控件之间切换焦点。

### 10.10. 处理文件访问权限

- **ID**: US-010
- **描述**: 作为一个 macOS 用户，如果 ConfigForge 没有权限读取或写入我的 `~/.ssh/config` 文件，我希望能得到清晰的提示和指引，告诉我如何授予必要的权限。
- **验收标准**:
  - 应用在启动或尝试读写 `~/.ssh/config` 文件时，如果检测到权限不足，会显示一个明确的错误消息。
  - 错误消息应解释为什么需要权限，并最好能提供简要的指引，告知用户可能需要在系统偏好设置的“隐私与安全性” > “文件和文件夹”或“完全磁盘访问权限”中为 ConfigForge 授权。
  - 在获得权限之前，应用的核心功能（列表显示、编辑、保存等）应被禁用或表现出相应的错误状态。
